- if not flash[:error].nil?
  %p.errorbox
    = flash[:error]
%p
  Below are the designated timeslots for this event. Timeslots that have been reserved by another team are greyed out. To sign up for a timeslot, click the word "Available!" next to the desired time.
%div{:class => ["bluebox", "smalllinks"]}
  %table#timeslot{:width => "100%", :style=>"padding:0;margin:0;"}
    %tr
      %td
        %b Timeslot
      %td
        %b Availability
    // Iterate over each timeslot
    - @allslots.each do |ts|
      - tr_id = ""
      - slots_remaining = ts.team_capacity - ts.sign_ups.length
      // First, check if the timeslot is full. If it is, but the team is registered there,
      //  they will still see their name in the table (as is desirable).
      - if slots_remaining == 0 and not (not session[:user].nil? and session[:user].is_admin)
        - tr_id = "unavailable"
      // If the team has registered for the event, show them their name.
      - if not @currentreg.nil? and ts.id == @currentreg.timeslot_id
        - display = session[:team].name
        - giveoptions = true
        - tr_id = "current"
      - else
        // If there are openings and this is not the currently registered one
        - display = "Available: " + slots_remaining.to_s + " Slot(s)"
        - giveoptions = false
      %tr{:id => tr_id}
        %td{:width => "25%"}
          = ts.begins.strftime("%I:%M %p")
        %td{:width => "75%"}
          - if (not session[:user].nil? and session[:user].is_admin)
            - ts.occupants.each do |team|
              = team.name
              %br
          - if @currentreg.nil?
            - if slots_remaining != 0
              =link_to(display, newsignup_url(ts))
            - else 
              - if not (not session[:user].nil? and session[:user].is_admin)
                Timeslot Full!
          - else
            - if tr_id != "current" and slots_remaining == 0
              Timeslot Full!
            - else
              = display
          - if giveoptions == true
            =link_to("(Unregister)",destroysignup_url(@currentreg),:class=>"action")
